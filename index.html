<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>xtt-utils</title>
		<script src="./xtt-ui.min.js"></script>

		<style>
			body {
				display: grid;
				column-gap: 8px;
				grid-template-columns: 200px 1fr;
			}
			#nav {
				overflow-x: auto;
				height: fit-content;
				position: sticky;
				top: 0;
			}
			#nav ul {
				list-style-type: none;
				padding-inline-start: 0;
				margin-block: 0;
			}

			#nav p {
				margin-block-end: 8px;
			}

			#nav a {
				padding-inline-start: 1em;
			}
		</style>
	</head>
	<body>
		<nav id="nav">
			<xtt-select id="selectedLang">
				<option selected value="en">English</option>
				<option value="cn">中国语</option>
			</xtt-select>
		</nav>
		<xtt-markdown id="markdown"></xtt-markdown>

		<script>
			const nav = document.querySelector("#nav");
			const selectedLang = document.querySelector("#selectedLang");
			const content = document.querySelector("#markdown");
			const mdCache = {
				en: null,
				cn: null
			};

			const createNav = () => {
				nav.querySelector("ul")?.remove();
				const headers = Array.from(content.headers).filter((h) => h.tagName === "H2" || h.tagName === "H3");

				const ul = document.createElement("ul");

				headers.forEach((h) => {
					const li = document.createElement("li");
					let c;

					if (h.tagName === "H2") {
						c = document.createElement("p");
					} else {
						c = document.createElement("a");
						c.href = "#" + h.id;
					}

					c.textContent = h.textContent;
					li.append(c);
					ul.append(li);
				});
				nav.append(ul);
			};

			const getContent = (lang = "en") => {
				if (mdCache[lang]) {
					content.textContent = mdCache[lang];
					setTimeout(createNav, 0);
					return;
				}
				fetch(`./xttUtils-${lang}.md`)
					.then((res) => {
						return res.text();
					})
					.then((text) => {
						mdCache[lang] = text;
						content.textContent = text;

						setTimeout(createNav, 0);
					});
			};

			getContent("en");

			selectedLang.addEventListener("change", (e) => {
				getContent(selectedLang.value);
			});
		</script>
	</body>
</html>
