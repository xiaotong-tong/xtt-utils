const { dataUrlToBlob } = require("xtt-utils");
require("expect-puppeteer");

describe("dataUrlToBlob module", () => {
	beforeAll(async () => {
		await page.goto("about:blank");
	});

	test("success", async () => {
		const b64 =
			"data:image/png;base64,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";

		// 往浏览器中注入 dataUrlToBlob 方法
		await page.addScriptTag({
			content: `const dataUrlToBlob = ${dataUrlToBlob.toString()};`
		});

		const isBlob = await page.evaluate(async (b64) => {
			const blob = await dataUrlToBlob(b64);
			return blob instanceof Blob;
		}, b64);

		expect(isBlob).toBe(true);
	});
});
